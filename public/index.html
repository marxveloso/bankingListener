<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Integração Belvo Widget OFDA</title>
  <script src="https://cdn.belvo.io/widget-ofda/v1.0/belvo-widget-ofda.min.js"></script>
  <style>
    body { font-family: Arial; background: #f8f8f8; }
    .container { max-width: 400px; margin: 50px auto; background: #fff; border-radius: 10px; box-shadow: 0 4px 16px #0001; padding: 24px; }
    button { background: #603be9; color: #fff; border: none; padding: 14px 28px; border-radius: 8px; font-size: 1rem; cursor: pointer; }
    button:hover { background: #4329a1; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Conecte sua Conta Bancária</h2>
    <p>Integração segura com Open Finance via Belvo.</p>
    <button id="connect-belvo">Conectar conta bancária</button>
  </div>
  <script>
    document.getElementById('connect-belvo').onclick = async function () {
      try {
        const res = await fetch('https://bankinglistener-production.up.railway.app/api/create-widget-token', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if (!data.access) {
          alert('Erro ao obter token: ' + (data.error || ''));
          return;
        }
        BelvoWidgetOFDA.create({
          accessToken: data.access,
          onSuccess: (link, institution) => {
            alert('Conta conectada! Você pode prosseguir.');
          },
          onExit: () => {
            alert('Processo cancelado pelo usuário.');
          },
          onError: (error) => {
            alert('Erro: ' + JSON.stringify(error));
          },
        }).open();
      } catch (err) {
        alert('Falha ao conectar ao backend: ' + err.message);
      }
    };
  </script>
</body>
</html>
